generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model inventario {
  id                  Int         @id @default(autoincrement())
  planta              String      @db.VarChar(50)
  title               String      @db.VarChar(100)
  nombre_material     String?     @db.VarChar(300)
  unidad_medida       String?     @db.VarChar(50)
  cod_nombre          String?     @db.VarChar(400)
  fecha_inventario    DateTime    @db.Date
  pallets             Int?        @default(0)
  stock               Decimal     @db.Decimal(10, 2)
  bodega              String?     @db.VarChar(100)
  ubicacion           String?     @db.VarChar(100)
  lote                String?     @db.VarChar(100)
  condicion_armado    String?     @db.VarChar(50)
  contado_por         String      @db.VarChar(100)
  fecha_creacion      DateTime?   @default(now()) @db.Timestamp(6)
  fecha_actualizacion DateTime?   @default(now()) @db.Timestamp(6)
  material_id         Int?
  ubicacion_id        Int?
  materiales          materiales? @relation(fields: [material_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  ubicacion_ref       ubicacion?  @relation(fields: [ubicacion_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([fecha_inventario], map: "idx_inventario_fecha")
  @@index([title], map: "idx_inventario_material")
  @@index([planta], map: "idx_inventario_planta")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model logs_sistema {
  id               Int       @id @default(autoincrement())
  usuario_id       Int?
  accion           String    @db.VarChar(100)
  modulo           String    @db.VarChar(50)
  descripcion      String?
  datos_anteriores Json?
  datos_nuevos     Json?
  ip_address       String?   @db.Inet
  fecha_creacion   DateTime? @default(now()) @db.Timestamp(6)
  usuarios         usuarios? @relation(fields: [usuario_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model materiales {
  id                         Int                          @id @default(autoincrement())
  codigo_ranco               String                       @unique @db.VarChar(50)
  nombre_material            String                       @db.VarChar(300)
  clasificacion              String?                      @db.VarChar(50)
  unidad_medida              String?                      @db.VarChar(50)
  frio                       String?                      @default("No") @db.VarChar(10)
  cod_nombre                 String?                      @db.VarChar(400)
  activo                     Boolean?                     @default(true)
  fecha_creacion             DateTime?                    @default(now()) @db.Timestamp(6)
  fecha_actualizacion        DateTime?                    @default(now()) @db.Timestamp(6)
  inventario                 inventario[]
  operaciones_frio_despacho  operaciones_frio_despacho[]
  recepciones_lotes          recepciones_lotes[]
  stock_ubicaciones          stock_ubicaciones[]
  tarjas                     tarjas[]
  trazabilidad_materiales_r9 trazabilidad_materiales_r9[]

  @@index([clasificacion], map: "idx_materiales_clasificacion")
  @@index([codigo_ranco], map: "idx_materiales_codigo")
  @@index([nombre_material], map: "idx_materiales_nombre")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model proveedores {
  id                         Int                          @id @default(autoincrement())
  title                      String                       @db.VarChar(200)
  ingreso_proveedores_100    Decimal?                     @default(0) @db.Decimal(10, 2)
  total_general              Decimal?                     @default(0) @db.Decimal(10, 2)
  activo                     Boolean?                     @default(true)
  fecha_creacion             DateTime?                    @default(now()) @db.Timestamp(6)
  fecha_actualizacion        DateTime?                    @default(now()) @db.Timestamp(6)
  recepciones_lotes          recepciones_lotes[]
  tarjas                     tarjas[]
  trazabilidad_materiales_r9 trazabilidad_materiales_r9[]
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model sesiones_usuario {
  id                  Int       @id @default(autoincrement())
  usuario_id          Int
  planta_seleccionada String    @db.VarChar(50)
  token_jwt           String
  fecha_inicio        DateTime? @default(now()) @db.Timestamp(6)
  fecha_expiracion    DateTime  @db.Timestamp(6)
  activa              Boolean?  @default(true)
  ip_address          String?   @db.Inet
  user_agent          String?
  usuarios            usuarios  @relation(fields: [usuario_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([activa], map: "idx_sesiones_activa")
  @@index([usuario_id], map: "idx_sesiones_usuario_id")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model temporadas_app {
  id                         Int                          @id @default(autoincrement())
  title                      String                       @db.VarChar(50)
  activo                     Boolean?                     @default(true)
  fecha_inicio               DateTime?                    @db.Date
  fecha_fin                  DateTime?                    @db.Date
  fecha_creacion             DateTime?                    @default(now()) @db.Timestamp(6)
  fecha_actualizacion        DateTime?                    @default(now()) @db.Timestamp(6)
  trazabilidad_materiales_r9 trazabilidad_materiales_r9[]
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model tipo_movimientos_app {
  id                         Int                          @id @default(autoincrement())
  title                      String                       @db.VarChar(100)
  descripcion                String?
  activo                     Boolean?                     @default(true)
  fecha_creacion             DateTime?                    @default(now()) @db.Timestamp(6)
  fecha_actualizacion        DateTime?                    @default(now()) @db.Timestamp(6)
  trazabilidad_materiales_r9 trazabilidad_materiales_r9[]
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model trazabilidad_materiales_r9 {
  id                                                                   Int                   @id @default(autoincrement())
  tipo_movimiento                                                      String                @db.VarChar(100)
  planta                                                               String                @db.VarChar(50)
  guia_sii                                                             String?               @db.VarChar(50)
  fecha                                                                DateTime              @db.Date
  mes                                                                  String?               @db.VarChar(20)
  id_movimiento                                                        String                @unique @db.VarChar(100)
  proveedor                                                            String?               @db.VarChar(200)
  lote                                                                 String?               @db.VarChar(100)
  title                                                                String                @db.VarChar(100)
  nombre                                                               String                @db.VarChar(300)
  cod_nombre                                                           String?               @db.VarChar(400)
  clasificacion                                                        String?               @db.VarChar(50)
  total_pallet                                                         Int?                  @default(0)
  cantidad                                                             Decimal               @db.Decimal(10, 2)
  unidad_medida                                                        String?               @db.VarChar(50)
  bod_origen                                                           String?               @db.VarChar(100)
  bod_destino                                                          String?               @db.VarChar(100)
  ubicacion_origen                                                     String?               @db.VarChar(100)
  ubicacion_destino                                                    String?               @db.VarChar(100)
  turno                                                                String?               @db.VarChar(20)
  temporada                                                            String?               @db.VarChar(50)
  observacion                                                          String?
  bodega_stock                                                         String?               @db.VarChar(100)
  ubicacion_stock                                                      String?               @db.VarChar(100)
  total_stock                                                          Decimal?              @db.Decimal(10, 2)
  numero_embarque                                                      String?               @db.VarChar(50)
  patente_camion                                                       String?               @db.VarChar(20)
  fecha_creacion                                                       DateTime?             @default(now()) @db.Timestamp(6)
  fecha_actualizacion                                                  DateTime?             @default(now()) @db.Timestamp(6)
  material_id                                                          Int?
  proveedor_id                                                         Int?
  ubicacion_origen_id                                                  Int?
  ubicacion_destino_id                                                 Int?
  temporada_id                                                         Int?
  tipo_movimiento_id                                                   Int?
  materiales                                                           materiales?           @relation(fields: [material_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  proveedores                                                          proveedores?          @relation(fields: [proveedor_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  temporadas_app                                                       temporadas_app?       @relation(fields: [temporada_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  tipo_movimientos_app                                                 tipo_movimientos_app? @relation(fields: [tipo_movimiento_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  ubicacion_trazabilidad_materiales_r9_ubicacion_destino_idToubicacion ubicacion?            @relation("trazabilidad_materiales_r9_ubicacion_destino_idToubicacion", fields: [ubicacion_destino_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  ubicacion_trazabilidad_materiales_r9_ubicacion_origen_idToubicacion  ubicacion?            @relation("trazabilidad_materiales_r9_ubicacion_origen_idToubicacion", fields: [ubicacion_origen_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([fecha], map: "idx_trazabilidad_fecha")
  @@index([title], map: "idx_trazabilidad_material")
  @@index([id_movimiento], map: "idx_trazabilidad_movimiento")
  @@index([planta], map: "idx_trazabilidad_planta")
  @@index([temporada], map: "idx_trazabilidad_temporada")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model ubicacion {
  id                                                                                    Int                          @id @default(autoincrement())
  title                                                                                 String                       @db.VarChar(100)
  bodega_deposito                                                                       String?                      @db.VarChar(100)
  planta                                                                                String?                      @db.VarChar(50)
  activo                                                                                Boolean?                     @default(true)
  fecha_creacion                                                                        DateTime?                    @default(now()) @db.Timestamp(6)
  fecha_actualizacion                                                                   DateTime?                    @default(now()) @db.Timestamp(6)
  inventario                                                                            inventario[]
  operaciones_frio_despacho_operaciones_frio_despacho_ubicacion_destino_idToubicacion   operaciones_frio_despacho[]  @relation("operaciones_frio_despacho_ubicacion_destino_idToubicacion")
  operaciones_frio_despacho_operaciones_frio_despacho_ubicacion_origen_idToubicacion    operaciones_frio_despacho[]  @relation("operaciones_frio_despacho_ubicacion_origen_idToubicacion")
  recepciones_lotes                                                                     recepciones_lotes[]
  stock_ubicaciones                                                                     stock_ubicaciones[]
  trazabilidad_materiales_r9_trazabilidad_materiales_r9_ubicacion_destino_idToubicacion trazabilidad_materiales_r9[] @relation("trazabilidad_materiales_r9_ubicacion_destino_idToubicacion")
  trazabilidad_materiales_r9_trazabilidad_materiales_r9_ubicacion_origen_idToubicacion  trazabilidad_materiales_r9[] @relation("trazabilidad_materiales_r9_ubicacion_origen_idToubicacion")

  @@index([bodega_deposito], map: "idx_ubicacion_bodega")
  @@index([planta], map: "idx_ubicacion_planta")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model usuarios {
  id                        Int                         @id @default(autoincrement())
  nombre_usuario            String                      @unique @db.VarChar(50)
  nombre_completo           String                      @db.VarChar(200)
  email                     String                      @unique @db.VarChar(200)
  password_hash             String                      @db.VarChar(255)
  planta_asignada           String?                     @db.VarChar(50)
  rol                       String?                     @default("operador") @db.VarChar(50)
  activo                    Boolean?                    @default(true)
  ultimo_acceso             DateTime?                   @db.Timestamp(6)
  fecha_creacion            DateTime?                   @default(now()) @db.Timestamp(6)
  fecha_actualizacion       DateTime?                   @default(now()) @db.Timestamp(6)
  logs_sistema              logs_sistema[]
  operaciones_frio_despacho operaciones_frio_despacho[]
  recepciones_lotes         recepciones_lotes[]
  sesiones_usuario          sesiones_usuario[]
  tarjas                    tarjas[]

  @@index([nombre_usuario], map: "idx_usuarios_nombre_usuario")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model operaciones_frio_despacho {
  id                                                                  Int         @id @default(autoincrement())
  numero_operacion                                                    String      @unique @db.VarChar(50)
  planta                                                              String      @db.VarChar(50)
  fecha_operacion                                                     DateTime    @db.Date
  tipo_operacion                                                      String      @db.VarChar(50)
  turno                                                               String?     @db.VarChar(20)
  numero_embarque                                                     String?     @db.VarChar(50)
  patente_camion                                                      String?     @db.VarChar(20)
  material_id                                                         Int?
  codigo_material                                                     String      @db.VarChar(50)
  nombre_material                                                     String      @db.VarChar(300)
  cod_nombre                                                          String?     @db.VarChar(400)
  unidad_medida                                                       String?     @db.VarChar(50)
  clasificacion                                                       String?     @db.VarChar(50)
  lote                                                                String?     @db.VarChar(100)
  cantidad                                                            Decimal     @db.Decimal(10, 2)
  ubicacion_origen_id                                                 Int?
  bodega_origen                                                       String?     @db.VarChar(100)
  ubicacion_origen                                                    String?     @db.VarChar(100)
  ubicacion_destino_id                                                Int?
  bodega_destino                                                      String?     @db.VarChar(100)
  ubicacion_destino                                                   String?     @db.VarChar(100)
  estado                                                              String?     @default("pendiente") @db.VarChar(20)
  observaciones                                                       String?
  usuario_id                                                          Int?
  fecha_creacion                                                      DateTime?   @default(now()) @db.Timestamp(6)
  fecha_procesamiento                                                 DateTime?   @db.Timestamp(6)
  materiales                                                          materiales? @relation(fields: [material_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  ubicacion_operaciones_frio_despacho_ubicacion_destino_idToubicacion ubicacion?  @relation("operaciones_frio_despacho_ubicacion_destino_idToubicacion", fields: [ubicacion_destino_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  ubicacion_operaciones_frio_despacho_ubicacion_origen_idToubicacion  ubicacion?  @relation("operaciones_frio_despacho_ubicacion_origen_idToubicacion", fields: [ubicacion_origen_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  usuarios                                                            usuarios?   @relation(fields: [usuario_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([numero_embarque], map: "idx_frio_embarque")
  @@index([fecha_operacion], map: "idx_frio_fecha")
  @@index([codigo_material], map: "idx_frio_material")
  @@index([planta], map: "idx_frio_planta")
  @@index([tipo_operacion], map: "idx_frio_tipo")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model recepciones_lotes {
  id                   Int          @id @default(autoincrement())
  numero_recepcion     String       @unique @db.VarChar(50)
  planta               String       @db.VarChar(50)
  fecha_recepcion      DateTime     @db.Date
  proveedor_id         Int?
  nombre_proveedor     String?      @db.VarChar(200)
  guia_sii             String?      @db.VarChar(50)
  material_id          Int?
  codigo_material      String       @db.VarChar(50)
  nombre_material      String       @db.VarChar(300)
  cod_nombre           String?      @db.VarChar(400)
  unidad_medida        String?      @db.VarChar(50)
  clasificacion        String?      @db.VarChar(50)
  lote                 String?      @db.VarChar(100)
  cantidad             Decimal      @db.Decimal(10, 2)
  pallets              Int?         @default(0)
  codigo_qr            String?
  ubicacion_destino_id Int?
  bodega_destino       String?      @db.VarChar(100)
  ubicacion_destino    String?      @db.VarChar(100)
  estado               String?      @default("pendiente") @db.VarChar(20)
  observaciones        String?
  usuario_id           Int?
  fecha_creacion       DateTime?    @default(now()) @db.Timestamp(6)
  fecha_procesamiento  DateTime?    @db.Timestamp(6)
  materiales           materiales?  @relation(fields: [material_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  proveedores          proveedores? @relation(fields: [proveedor_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  ubicacion            ubicacion?   @relation(fields: [ubicacion_destino_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  usuarios             usuarios?    @relation(fields: [usuario_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([estado], map: "idx_recepciones_estado")
  @@index([fecha_recepcion], map: "idx_recepciones_fecha")
  @@index([codigo_material], map: "idx_recepciones_material")
  @@index([planta], map: "idx_recepciones_planta")
  @@index([nombre_proveedor], map: "idx_recepciones_proveedor")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model stock_ubicaciones {
  id                      Int         @id @default(autoincrement())
  material_id             Int?
  codigo_material         String      @db.VarChar(50)
  nombre_material         String      @db.VarChar(300)
  ubicacion_id            Int?
  planta                  String      @db.VarChar(50)
  bodega                  String      @db.VarChar(100)
  ubicacion_nombre        String      @db.VarChar(100)
  lote                    String?     @db.VarChar(100)
  cantidad_actual         Decimal     @default(0) @db.Decimal(10, 2)
  cantidad_reservada      Decimal?    @default(0) @db.Decimal(10, 2)
  fecha_ultimo_movimiento DateTime?   @db.Timestamp(6)
  fecha_actualizacion     DateTime?   @default(now()) @db.Timestamp(6)
  materiales              materiales? @relation(fields: [material_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  ubicacion               ubicacion?  @relation(fields: [ubicacion_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([material_id, ubicacion_id, lote])
  @@index([cantidad_actual], map: "idx_stock_cantidad")
  @@index([material_id, ubicacion_id], map: "idx_stock_material_ubicacion")
  @@index([planta], map: "idx_stock_planta")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model tarjas {
  id               Int          @id @default(autoincrement())
  numero_tarja     String       @unique @db.VarChar(50)
  planta           String       @db.VarChar(50)
  fecha_generacion DateTime     @db.Date
  tipo_tarja       String       @db.VarChar(20)
  descripcion      String
  material_id      Int?
  codigo_material  String       @db.VarChar(50)
  nombre_material  String       @db.VarChar(300)
  lote             String?      @db.VarChar(100)
  cantidad         Decimal      @db.Decimal(10, 2)
  numero_item      Int?
  fecha_item       DateTime?    @db.Date
  proveedor_id     Int?
  nombre_proveedor String?      @db.VarChar(200)
  guia             String?      @db.VarChar(50)
  estado           String?      @default("generada") @db.VarChar(20)
  usuario_id       Int?
  fecha_creacion   DateTime?    @default(now()) @db.Timestamp(6)
  fecha_impresion  DateTime?    @db.Timestamp(6)
  materiales       materiales?  @relation(fields: [material_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  proveedores      proveedores? @relation(fields: [proveedor_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  usuarios         usuarios?    @relation(fields: [usuario_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([estado], map: "idx_tarjas_estado")
  @@index([fecha_generacion], map: "idx_tarjas_fecha")
  @@index([codigo_material], map: "idx_tarjas_material")
  @@index([planta], map: "idx_tarjas_planta")
  @@index([tipo_tarja], map: "idx_tarjas_tipo")
}
